//Funktion för animering
$(function(){
    setTimeout(function(){
        //hämta animeradText class för att ta bort "hidden" class 
        $('.animeradText').removeClass('hidden');
    }, 500);
});


//skapar en funktion för att printa ut text i <label> tagg med färg
function skrivMeddelande(meddelande, meddelandePlatsen, color){
document.getElementById(meddelandePlatsen).innerHTML = meddelande;
document.getElementById(meddelandePlatsen).style.color = color;

}



//Funktion för bildspelet
function startaBildspel(){
    
var countBildspel = 1;
function bildspel(){
    var listan =["bild1.jpg", "bild2.jpg", "bild3.jpg"];

    if (countBildspel <= listan.length-1 ){
        var namnet = "bilder/" + listan[countBildspel];
        document.getElementById("bilden").src = namnet;
        countBildspel++;
        
    }
    else {
        document.getElementById("bilden").src = "bilder/" + listan[0];
        countBildspel = 1;
        
    }
} 

//För att det ska gå att pausa och köra bildspelet igen

    var korBildspel = true;
    
    function knappTryck(){
        if(korBildspel){
            clearInterval(timern);
            korBildspel = false;
            document.getElementById("bildspelsKnapp").innerHTML = "Play";
            
        }
        else{
            timern = setInterval(bildspel, 5000);
            korBildspel = true;
            document.getElementById("bildspelsKnapp").innerHTML = "Pause";
            
        }
    }
    var timern = setInterval(bildspel, 5000);
    document.getElementById("bildspelsKnapp").onclick = knappTryck;
    };


    

    //Funktion för att validera namn
function valideraNamn(){
var namnet =document.getElementById("namn").value;//Hämtar namnet som användaren skriver
if(namnet.length == 0){
    skrivMeddelande("Du måste fylla i fältet", "commentOnNamn", "red");
    return false;
}
if(!namnet.match(/^[A-Za-z]*\s{1}[A-Za-z]*$/)){
    skrivMeddelande("Skriv ditt förnamn och efternamn med ett mellanslag", "commentOnNamn", "red")
    return false;
}else{
    skrivMeddelande("Namnet är validerat", "commentOnNamn", "black")
    return true;
}

}

//Validerar nummer
function valideraNummer(){
var nummer = document.getElementById("telefonnummer").value;

if(nummer.length == 0){
    skrivMeddelande("Du måste fylla i fältet", "commentOnNummer", "red");
    return false;
}
if(nummer.length < 10){
    skrivMeddelande("Skriv 10 nummer", "commentOnNummer", "red");
    return false;
}
if(!nummer.match(/^[0-9]{10}$/)){
    skrivMeddelande("Bara 10 nummer", "commentOnNummer", "red");
    return false;
}

    skrivMeddelande("Nummer är validerat", "commentOnNummer", "black");
    return true;

}
//Validerar epost
function valideraEPost(){
var e_post =document.getElementById("e_post").value;

if(e_post.length == 0){
    skrivMeddelande("Du måste fylla i fältet", "commentOnE_post", "red");
    return false;
}
if(!e_post.match(/^[A-Za-z0-9_\-\.]{1,}\@[A-Za-z0-9_\-\.]{1,}\.[A-Za-z]{2,4}$/)){
    skrivMeddelande("Fel e-postadress", "commentOnE_post", "red");
    return false;
}
else{
    skrivMeddelande("E_postadressen är validerat", "commentOnE_post", "black");
    return true;
}
}
//Validerar meddelande
function valideraMeddelande(){
var meddelande = document.getElementById("meddelande").value;

if(meddelande.length == 0){
    skrivMeddelande("Du måste fylla i fältet", "commentOnMeddelande", "red");
    return false;
}
else{
skrivMeddelande("Meddelande är validerat", "commentOnMeddelande", "black");
return true;
}
}

//Validerar hela formen
function valideraForm(){

if(!valideraNamn() || !valideraNummer() || !valideraEPost() || !valideraMeddelande()){
    show("commentOnButton");
    skrivMeddelande("Något saknas! kolla igenom informationen", "commentOnButton", "red");
    setTimeout(function(){hide("commentOnButton");}, 2000);
    
}
else{
    alert("Dina uppgifter sparades!");
    //Spara namnet
    var namnet =document.getElementById("namn").value;
    localStorage.setItem('sparatNamn', JSON.stringify(namnet));

    //spara telefonnummer
    
    var telefonnummer =document.getElementById("telefonnummer").value;
    localStorage.setItem('sparatNummer', JSON.stringify(telefonnummer));

    //Spara epost
    var emailAdress =document.getElementById("e_post").value;
    localStorage.setItem('sparadEmail', JSON.stringify(emailAdress));
}

}
//ett funktion som vissar meddelandet som vi vill skriva på skärmen
function show(id){
 document.getElementById(id).style.display= "block";
}
//ett funktion som döljer meddelandet som vi har vissat
function hide(id){
document.getElementById(id).style.display= "none";   
}







//Fixa trending saken här
  $(document).ready(() => {
      
    function tableFromLanguage(lang){ //Ta in vilket språk den ska köras på
        var gitUrl= 'https://api.github.com/search/repositories?q=trending+language:'+lang+'&sort=stars&order=desc'; //Skapa url med språk
        var listan = [];
        var tableId= '#listaAv'+lang;
    fetch(gitUrl)
    .then(response => response.json())
    .then(data => {
      listan = data.items.slice(0, 5) //Gör lista av top 5
      listan.forEach((repo) =>{     //för varje på listan så...

        //Table med namn osv för själva repot
        var rad = $(
            `<tr class="repoRad">
                <td> <a href="${repo.html_url}"> ${repo.name}</a> </td>
                <td>${repo.stargazers_count}</td>
                <td><a href="${repo.owner.html_url}"> ${repo.owner.login}</a></td>
                <td><button id="${repo.id}">Visa mer</button> <button id="${repo.id}2">Mindre</button></td>
            </tr> 
            
            `
            
        );

        $(tableId).append(rad); //Lägg rad i table

        //Här tar vi fram lista på contributors
        var contUrl = repo.contributors_url; //Url till api för cont för just det repot
          var listaAvCont = [];
          fetch(contUrl)
          .then(response => response.json())
          .then(data =>{
              listaAvCont = data;
              var contTable = "#listaPaCont";
              var firstCont =$(
                `<tr class="${repo.id} contributorTable">
                    <td>Contributors till</td>
                    <td></td>
                    <td>${repo.name}</td>
                </tr>`
              )
              $(contTable).append(firstCont);
               listaAvCont.forEach((contributorOnList) =>{
                  var contRad = $(
                `<tr class="${repo.id} contributorTable">
                    <td> <img class="picOfCont" src="${contributorOnList.avatar_url}"> </td>
                    <td></td>
                    <td>${contributorOnList.login}</td>
                </tr>`
                );
                $(contTable).append(contRad);
                $("."+repo.id).hide();
              })
          })

          
         
        
          lang = '';
          var knappId= "#" +repo.id;
          $("."+repo.id).hide();

          $(knappId).click(function(){ //Klicka på mer så visas contributors table
            $("."+repo.id).show();
            $(knappId).hide();
            $(knappId2).show();
        });
        var knappId2= "#" +repo.id + "2";
        $(knappId2).hide();
        $(knappId2).click(function visaMindre(){//klicka på mindre så försvinner cont. och knappen ändas
          $("."+repo.id).hide();
          $(knappId2).hide();
          $(knappId).show();
      });
      
      })
    })
    .catch(error => console.log('Error is', error)); 
  }
  tableFromLanguage('Javascript');
  tableFromLanguage('CSS');

  });


//Kartans kod

function laddaKarta(){
    var varKarta = L.map('kartansId').setView([59.254, 15.25], 15);
   
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(varKarta);
}

  

    //Ladda in info i kontaktformulär
    function laddaKontaktinfo(){
    document.getElementById("namn").value =  JSON.parse(localStorage.getItem('sparatNamn'));
    document.getElementById("telefonnummer").value =  JSON.parse(localStorage.getItem('sparatNummer'));
    document.getElementById("e_post").value =  JSON.parse(localStorage.getItem('sparadEmail'));
    }


/* En funktion som oppnar mobilens meny*/ 
function oppnaMobilNavMeny(){
    document.getElementById("mobilNavMeny").style.width ='250px';

}
/*En funktion som oppnar mobilens meny*/ 
function stangMobilNavMeny(){
    document.getElementById("mobilNavMeny").style.width ='0';
    
}
